<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>ZIM - Code Creativity</title>

<!-- zimjs.com - JavaScript Canvas Framework -->
<script type="module">

import zim from "https://zimjs.org/cdn/017/zim";

const fruitNames = []
for (let i = 0; i < 228; i ++){
    // push(on end), pop(off end), unshift(on start), shift(off start)
    if(i < 10)
        fruitNames.push("tile00"+i+".png");
    else if(i < 100)
        fruitNames.push("tile0"+i+".png");
    else
        fruitNames.push("tile"+i+".png");
}
fruitNames.push("dog.png");
zogb(fruitNames);
// See Docs under Frame for FIT, FILL, FULL, and TAG
// Spread operator ... which spreads one array into another
new Frame(FIT, 1024, 768, black, interstellar, ready, [...fruitNames,"gf_Jockey+One","boom.png","boom.mp3","bg1.png", "basket.png", "dog.png"], "assets/");
function ready() {

    const boomSound = new Aud("boom.mp3");

    const explosion = new Sprite("boom.png", 8, 6).reg(CENTER);

    let score = 0;
    
    // given F (Frame), S (Stage), W (width), H (height)
    // put code here
    
    const space = new Pic("bg1.png").siz(W).center();
    space.noMouse();


    new Scroller(space,null,-1,false)

    new Label("Fruit Catch",120,"Jockey One",pink)
    .alp(0.25)
    .pos(0,50,CENTER,TOP)
    .animate({
        from:true,
        props:{y:-100},
        ease:"bounce",
        loop:true,
        rewind:true
    });





    // setInterval(() = >{
    //     console.log("hi");
        
    // }, 1000);

    // setTimeout(() => {
    //     console.log("once");
    // }, 5000);

    const fruits = new Container(W,H).addTo();


    interval({min:.5, max:2},()=>{
        const fruit = new Pic(fruitNames)
        .sca(5)
        .loc(rand(W),-100,fruits)
        .reg(CENTER)
        .cur("crosshair")
        .animate({
            // ternary operator if then else
            // Math.random()>0.5 ? 360 : -360
            props:{rotation:[360,-360]},
            // time: 2,
            // ease:"elasticInOut",
            // rewind:true,
            time: rand(5,8),
            ease: "linear",
            loop:true
        })
        .animate({
            props:{y:H},
            time: rand(3,6),
            ease:"linear",
            call:()=>{
                fruit.dispose();
                boomSound.play();
                score --;
                scorer.text = score;
            }
        });

        
        
    })

    
    // const boomSound = new Aud("boom.mp3");
    // const explosion = new Sprite("boom.png", 8, 6).reg(CENTER);

    // No longer needed
    // fruits.on("mousedown", (e)=>{
    //     explode(e.target);
    //     score ++;
    //     scorer.text = score;
    //     fruit.dispose();

    // })


    

    const basket = new Pic("basket.png")
        .reg(CENTER)
        .sca(.25)
        .pos(0,50,CENTER,BOTTOM)
    
    // //window.addEventListener("keydown", movebasket);movebasket);

    // F.on("keydown", (e) =>{ //you can take off the round brackets around e if there is only one parameter
    //     zogp(e.key);
    //     if (e.key == "ArrowLeft") 
    //         basket.mov(-5);
    //     else if (e.key == "ArrowRight")
    //         basket.mov(5);
    // });

    new MotionController(basket,"keydown",null,HORIZONTAL,new Boundary(basket.width/2,basket.y,W-basket.width,0));
    // new MotionController({
    //     target:basket,
    //     mousedownIncludes:space
    // });



        

    // // Do not chain the on method as it returns an id to turn off()
    // fruit.on("mousedown", explode);

    function explode(fruit) {
        // zogr();
        // boomSound.play();

        // explosion.sca(1.5).loc(fruit).run();

        // fruit.removeFrom();

        boomSound.play();
        explosion.sca(1.5).loc(fruit).run();
        fruit.dispose();
        console.log("RAHHHHHH");
    }


    Ticker.add(()=>{
        // https://zimjs.com/tips#HITTEST
        fruits.loop(fruit=>{
            if (fruit.hitTestCircle(basket)){
                
                console.log("hit");
                score ++;
                scorer.text = score;
                fruit.dispose();

            }
        }, true) // true is loop backwards
    })

    STYLE = {backgroundColor:yellow, shiftV:6}
    const scorer = new Label(0,50,"Jockey One", black).pos(70,70,RIGHT)


    

} // end ready

</script>
<meta name="viewport" content="width=device-width, user-scalable=no" />
</head>
<body></body>
</html>
